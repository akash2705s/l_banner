<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L-Banner CDN Example</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/akash768145s/L_Banner@1.0/dist/lbanner-player.min.css"
    />
  </head>
  <body>
    <!-- Cache Management Panel -->
    <div
      id="cache-management-panel"
      style="
        position: fixed;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 12px;
        z-index: 10000;
        max-width: 350px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      "
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 10px;
        "
      >
        <strong style="color: #4caf50">Cache Management</strong>
        <button
          id="clear-cache-btn"
          style="
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
          "
        >
          Clear Cache
        </button>
      </div>
      <div id="cache-info" style="font-size: 11px; color: #ccc">
        <div>Banners in cache: <span id="cache-count">0</span></div>
        <div style="margin-top: 5px; max-height: 150px; overflow-y: auto">
          <div style="font-size: 10px; color: #999">Cache Data:</div>
          <pre
            id="cache-data-display"
            style="
              margin-top: 5px;
              font-size: 9px;
              white-space: pre-wrap;
              word-break: break-all;
              color: #e0e0e0;
            "
          >
{}</pre
          >
        </div>
      </div>
    </div>

    <div id="player-shell" class="shaka-player-container">
      <div id="video-area" data-role="video-area">
        <video
          id="video-element"
          class="shaka-video"
          data-video-src="https://storage.googleapis.com/shaka-demo-assets/angel-one/dash.mpd"
          autoplay
          muted
          playsinline
        ></video>
      </div>
      <div id="l-banner-host" aria-live="polite"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/akash768145s/L_Banner@1.0/dist/lbanner-player.min.js"></script>
    <script>
      // Analytics Configuration - MUST be set before initialization
      // IMPORTANT: ENABLE_ANALYTICS must ALWAYS be true for banners to display
      window.ENABLE_ANALYTICS = true; // MUST ALWAYS BE TRUE - Required for banners to work
      window.LBannerAnalyticsConfig = {
        showStatusPanel: false, // Set to true/false to show/hide the status panel
        showCachePanel: true, // Set to true/false to show/hide the cache management panel
      };

      // Cache Management Functions
      function updateCacheDisplay() {
        const panel = document.getElementById("cache-management-panel");
        if (!panel) return;

        const config = window.LBannerAnalyticsConfig || {};

        // Hide panel if showCachePanel is false
        if (config.showCachePanel === false) {
          panel.style.display = "none";
          return;
        }

        // Hide panel if cookie tracking is disabled
        // Check from analytics state or global flag
        const cookieTrackingEnabled = window.cookieTrackingEnabled !== false;
        if (!cookieTrackingEnabled) {
          panel.style.display = "none";
          return;
        }

        panel.style.display = "block";

        if (
          window.LBannerAnalytics &&
          typeof window.LBannerAnalytics.checkCookieStatus === "function"
        ) {
          const cookieData = window.LBannerAnalytics.checkCookieStatus();
          const bannerIds = Object.keys(cookieData);
          const countEl = document.getElementById("cache-count");
          const dataEl = document.getElementById("cache-data-display");

          if (countEl) {
            countEl.textContent = bannerIds.length;
          }

          if (dataEl) {
            if (bannerIds.length > 0) {
              const formatted = bannerIds
                .map((id) => {
                  const banner = cookieData[id];
                  const lastShown = banner.lastShown
                    ? new Date(banner.lastShown).toLocaleString()
                    : "N/A";
                  return `  "${id}": { state: "${
                    banner.state || "notclicked"
                  }", lastShown: ${lastShown} }`;
                })
                .join(",\n");
              dataEl.textContent = `{\n${formatted}\n}`;
            } else {
              dataEl.textContent = "{}";
            }
          }
        }
      }

      function clearCache() {
        if (confirm("Are you sure you want to clear all banner cache data?")) {
          // Clear the cookie
          document.cookie = "lbanner_elements=; path=/; max-age=0";
          console.log("[Cache] Cache cleared");
          updateCacheDisplay();
        }
      }

      // Initialize L-Banner Player
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          // Toggle these options on/off:
          const ENABLE_COOKIE_TRACKING = false; // Set to true/false to enable/disable cookie tracking
          const SHOW_BANNERS_ON_PAUSE = true; // Set to true/false to show/hide banners on pause

          // Store cookie tracking state globally for cache panel visibility
          window.cookieTrackingEnabled = ENABLE_COOKIE_TRACKING;

          // Hide cache panel immediately if cookie tracking is disabled
          if (!ENABLE_COOKIE_TRACKING) {
            const panel = document.getElementById("cache-management-panel");
            if (panel) {
              panel.style.display = "none";
            }
          }

          await window.LBannerPlayer.init({
            apiKey: "your-api-key-here",
            vastUrl: "./banners/left-bottom-image.xml",
            enableCookieTracking: ENABLE_COOKIE_TRACKING,
            showBannersOnPause: SHOW_BANNERS_ON_PAUSE,
          });

          // Setup cache management panel
          const clearBtn = document.getElementById("clear-cache-btn");
          if (clearBtn) {
            clearBtn.addEventListener("click", clearCache);
          }

          // Update cache display periodically
          setInterval(updateCacheDisplay, 1000);
          updateCacheDisplay();

          // Listen for cookie updates
          window.addEventListener("lbanner-cookie-updated", updateCacheDisplay);
        } catch (error) {
          console.error("Failed to initialize L-Banner:", error);
        }
      });
    </script>
  </body>
</html>
