<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test VAST Endpoint</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>VAST Endpoint Tester</h1>
    
    <div class="test-section">
        <h2>Test Configuration</h2>
        <p><strong>Endpoint:</strong> <code>https://canvas-siau-server-seven.vercel.app/api/vastBrand/691967ce86a661e6c4af1c86/random</code></p>
        <p><strong>Token:</strong> <code id="token-display">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></p>
    </div>

    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="testEndpoint()">Test VAST Endpoint</button>
        <button onclick="testWithCurl()">Show cURL Command</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div class="test-section">
        <h2>Results</h2>
        <div id="results"></div>
    </div>

    <script>
        const BEARER_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY5MTk2N2MzODZhNjYxZTZjNGFmMWM4MSIsImVtYWlsIjoiY2hpcmFnQGNhbnZhcy5zcGFjZSIsImlhdCI6MTc2MzkwNzM3MiwiZXhwIjoxNzY0NTEyMTcyfQ.2avb-y9mrZ5TUeQehQUF9Luj1dCkTZPJ806006EV7dY";
        const VAST_URL = "https://canvas-siau-server-seven.vercel.app/api/vastBrand/691967ce86a661e6c4af1c86/random";

        async function testEndpoint() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing endpoint...</p>';

            try {
                console.log('Fetching VAST XML with authentication...');
                const response = await fetch(VAST_URL, {
                    headers: {
                        'Authorization': `Bearer ${BEARER_TOKEN}`
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    const errorText = await response.text();
                    resultsDiv.innerHTML = `
                        <p class="error"><strong>Error ${response.status}:</strong> ${response.statusText}</p>
                        <pre>${errorText}</pre>
                    `;
                    return;
                }

                const contentType = response.headers.get('content-type');
                const vastXml = await response.text();

                resultsDiv.innerHTML = `
                    <p class="success"><strong>✓ Success!</strong></p>
                    <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                    <p><strong>Content-Type:</strong> ${contentType}</p>
                    <p><strong>Response Length:</strong> ${vastXml.length} characters</p>
                    <details>
                        <summary><strong>VAST XML Preview (first 500 chars):</strong></summary>
                        <pre>${escapeHtml(vastXml.substring(0, 500))}...</pre>
                    </details>
                    <details>
                        <summary><strong>Full VAST XML:</strong></summary>
                        <pre>${escapeHtml(vastXml)}</pre>
                    </details>
                `;

                // Validate it's valid XML
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(vastXml, 'text/xml');
                    const parserError = xmlDoc.querySelector('parsererror');
                    if (parserError) {
                        resultsDiv.innerHTML += `<p class="error"><strong>XML Parse Error:</strong> ${parserError.textContent}</p>`;
                    } else {
                        resultsDiv.innerHTML += `<p class="success"><strong>✓ Valid XML</strong></p>`;
                    }
                } catch (e) {
                    resultsDiv.innerHTML += `<p class="error"><strong>XML Validation Error:</strong> ${e.message}</p>`;
                }

            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `
                    <p class="error"><strong>Error:</strong> ${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
            }
        }

        function testWithCurl() {
            const curlCommand = `curl -X GET \\
  "https://canvas-siau-server-seven.vercel.app/api/vastBrand/691967ce86a661e6c4af1c86/random" \\
  -H "Authorization: Bearer ${BEARER_TOKEN}" \\
  -H "Content-Type: application/xml"`;

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3>cURL Command:</h3>
                <pre>${curlCommand}</pre>
                <p>Copy this command and run it in your terminal to test the endpoint.</p>
            `;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('Page loaded. Click "Test VAST Endpoint" to test.');
        });
    </script>
</body>
</html>

